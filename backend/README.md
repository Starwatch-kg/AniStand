# üéå AniStand Backend

–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π backend –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∞–Ω–∏–º–µ, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ FastAPI —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **FastAPI** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π, –±—ã—Å—Ç—Ä—ã–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PostgreSQL** - –Ω–∞–¥–µ–∂–Ω–∞—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Redis** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—ã—Å–æ–∫–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **JWT Authentication** - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **Celery** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
- **–ü–∞—Ä—Å–∏–Ω–≥** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AniList, Animepahe, GogoAnime
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- PostgreSQL 13+
- Redis 6+
- Docker (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:**
```bash
git clone https://github.com/Starwatch-kg/AniStand.git
cd AniStand/backend
```

2. **–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate  # Windows
```

3. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
```bash
pip install -r requirements.txt
```

4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª —Å –≤–∞—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

5. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```bash
# –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL
createdb anistand

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head
```

6. **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:**
```bash
uvicorn app.main:app --reload
```

### Docker —É—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ó–∞–ø—É—Å–∫ —Å Docker Compose:**
```bash
docker-compose up -d
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
- PostgreSQL (–ø–æ—Ä—Ç 5432)
- Redis (–ø–æ—Ä—Ç 6379)
- FastAPI Backend (–ø–æ—Ä—Ç 8000)
- Celery Worker
- Celery Beat
- Flower (–ø–æ—Ä—Ç 5555)

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
APP_NAME=AniStand API
VERSION=1.0.0
DEBUG=True

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql+asyncpg://user:password@localhost/anistand

# Redis
REDIS_URL=redis://localhost:6379/0

# JWT
JWT_SECRET_KEY=your-secret-key
ACCESS_TOKEN_EXPIRE_MINUTES=30

# CORS
ALLOWED_ORIGINS=["http://localhost:3000"]

# –ü–∞—Ä—Å–∏–Ω–≥
PARSER_DELAY=1.0
CACHE_TTL_ANIME=3600
```

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å–∞–º:
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

#### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /api/v1/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/v1/auth/login` - –í—Ö–æ–¥
- `POST /api/v1/auth/refresh` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

#### –ê–Ω–∏–º–µ
- `GET /api/v1/anime/` - –°–ø–∏—Å–æ–∫ –∞–Ω–∏–º–µ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
- `GET /api/v1/anime/{id}` - –î–µ—Ç–∞–ª–∏ –∞–Ω–∏–º–µ
- `GET /api/v1/anime/search` - –ü–æ–∏—Å–∫ –∞–Ω–∏–º–µ

#### –≠–ø–∏–∑–æ–¥—ã
- `GET /api/v1/episodes/anime/{anime_id}` - –≠–ø–∏–∑–æ–¥—ã –∞–Ω–∏–º–µ
- `GET /api/v1/episodes/{id}/sources` - –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –≤–∏–¥–µ–æ
- `POST /api/v1/episodes/{id}/progress` - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `GET /api/v1/users/me` - –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/v1/users/favorites` - –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
- `GET /api/v1/users/history` - –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

- **anime** - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–Ω–∏–º–µ
- **episodes** - –≠–ø–∏–∑–æ–¥—ã
- **video_sources** - –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –≤–∏–¥–µ–æ
- **users** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- **user_favorites** - –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
- **watch_history** - –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
- **comments** - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- **ratings** - –†–µ–π—Ç–∏–Ω–≥–∏

## ü§ñ –°–∏—Å—Ç–µ–º–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

1. **AniList** - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∞–Ω–∏–º–µ
2. **Animepahe** - –í–∏–¥–µ–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
3. **GogoAnime** - –í–∏–¥–µ–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

### –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á

- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö** - –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ** - –∫–∞–∂–¥—ã–µ 2 —á–∞—Å–∞
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö —ç–ø–∏–∑–æ–¥–æ–≤** - –∫–∞–∂–¥—ã–π —á–∞—Å
- **–û—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Å—ã–ª–æ–∫** - –µ–∂–µ–¥–Ω–µ–≤–Ω–æ

### –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞

```bash
# Celery Worker
celery -A app.parsers.scheduler worker --loglevel=info

# Celery Beat (–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫)
celery -A app.parsers.scheduler beat --loglevel=info

# Flower (–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
celery -A app.parsers.scheduler flower
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install pytest pytest-asyncio httpx

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
pytest

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=app
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check
```bash
curl http://localhost:8000/health
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Redis
```bash
curl http://localhost:8000/api/v1/cache/stats
```

### Flower (Celery)
–û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:5555 –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∑–∞–¥–∞—á Celery

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π —Å bcrypt
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- Rate limiting (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

1. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```env
DEBUG=False
JWT_SECRET_KEY=strong-random-key
DATABASE_URL=postgresql://...
REDIS_URL=redis://...
```

2. **Gunicorn:**
```bash
gunicorn app.main:app -w 4 -k uvicorn.workers.UvicornWorker
```

3. **Nginx** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## ü§ù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/           # API —Ä–æ—É—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ models/        # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas/       # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/      # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ parsers/       # –ü–∞—Ä—Å–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ utils/         # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ config.py      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.py    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ main.py        # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ alembic/           # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ requirements.txt   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ docker-compose.yml # Docker –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä—Å–µ—Ä–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –∫–ª–∞—Å—Å, –Ω–∞—Å–ª–µ–¥—É—é—â–∏–π –æ—Ç `BaseParser`
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –º–µ—Ç–æ–¥—ã `get_anime_metadata`, `get_episodes`, `get_video_sources`
3. –î–æ–±–∞–≤—å—Ç–µ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞

1. –°–æ–∑–¥–∞–π—Ç–µ Pydantic —Å—Ö–µ–º—ã –≤ `schemas/`
2. –î–æ–±–∞–≤—å—Ç–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ `services/`
3. –°–æ–∑–¥–∞–π—Ç–µ —Ä–æ—É—Ç—ã –≤ `api/routes/`
4. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–æ—É—Ç–µ—Ä –≤ `main.py`

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ [Issues](https://github.com/Starwatch-kg/AniStand/issues)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Issue
3. –°–≤—è–∂–∏—Ç–µ—Å—å —Å –∫–æ–º–∞–Ω–¥–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

**AniStand Backend** - –°–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∞–Ω–∏–º–µ üéå
